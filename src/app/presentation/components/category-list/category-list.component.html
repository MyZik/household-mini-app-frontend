@let categoriesData = categories();

@if (categoriesData === 'loading' || categoriesData === 'not-loaded') {
    <app-loading-duck 
        message="Daten werden geladen..." 
        duckType="dancing">
    </app-loading-duck>
} @else if (categoriesData === 'load-failed') {
    <div class="error-container">
        <mat-icon class="error-icon">error_outline</mat-icon>
        <h2 class="error-title">Fehler beim Laden der Daten</h2>
        <p class="error-text">
            Die Kategorien konnten nicht geladen werden. Bitte versuche es später erneut.
        </p>
    </div>
} @else {
    @if (categoriesData && categoriesData.length === 0) {
        <div class="empty-container">
            <img src="assets/duck-lens-transparent.png" alt="Entchen" class="empty-duck-image">
            <p class="empty-message">Keine Kategorien gefunden.</p>
            <p class="empty-suggestion">Möchtest du deine erste Kategorie erstellen?</p>
            <button mat-raised-button color="primary" class="create-button">
                Neue Kategorie erstellen
            </button>
        </div>
    } @else {
        <div class="category-list-container">
            <h1 class="category-list-title">Meine Kategorien</h1>

            <div class="category-cards">
                @for (category of categoriesData; track category.id) {
                    <mat-card class="category-card">
                        <div class="category-header" (click)="togglePanel(category.id)">
                            <div class="category-info">
                                <span class="category-emoji">{{ category.emoji }}</span>
                                <span class="category-name">{{ category.name }}</span>
                            </div>
                            <mat-icon class="toggle-button"
                                >{{ isPanelExpanded(category.id) ? 'expand_less' : 'expand_more' }}
                            </mat-icon>
                        </div>

                        @if (isPanelExpanded(category.id)) {
                            <mat-card-content
                                class="category-items"
                                (click)="$event.stopPropagation()"
                            >
                                <div class="item-list">
                                    @for (item of category.items; track item.id) {
                                        <div class="item">
                                            <div class="item-emoji">{{ item.emoji }}</div>
                                            <div class="item-name">{{ item.name }}</div>
                                            <div class="item-quantity">{{ item.quantity }}</div>
                                        </div>
                                    }
                                </div>
                            </mat-card-content>
                        }
                    </mat-card>
                }
            </div>
        </div>
    }
}
